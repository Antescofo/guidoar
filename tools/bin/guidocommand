#!/bin/sh
#

function usage() {
	echo "usage: $(basename $0) <guidotool> arg1 arg2 [arg3...argn]"
	echo "                   where <guidotool> is a guido tool available from the current PATH"
	echo "                   argi is a file name, litteral gmn code, or '-' for standard input"
	exit 1
}

[ $# -lt 3 ] && usage

tool=$1
which $tool > /dev/null || usage
shift


function readall() {
	in=""
	while read line
	do
		in="$in $line"
	done
	echo $in 
}

arg1=$1
arg2=$2
if [ $1 == "-" ] ||  [ $2 == "-" ]
then
	readall > __tmp$$
	[ $1 == "-" ] && arg1=__tmp$$
	[ $2 == "-" ] && arg2=__tmp$$
fi

cmd="$tool \"$arg1\" \"$arg2\""
shift
shift
while [ "$1" ]
do
 	arg="$1"
 	[ "$1" == "-" ] && [ -z "$in" ] && readall > __tmp$$
 	[ "$1" == "-" ] && arg=__tmp$$
 	cmd="$cmd | $tool - \"$arg\""
	shift
done
#echo $cmd
eval $cmd
result=$?
rm -f __tmp$$
exit $result
